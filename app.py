import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt

st.set_page_config(page_title="Sun to Sort", layout="wide")

st.title("üåû Sun to Sort: ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏™‡∏á‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Ñ‡∏±‡∏î‡πÅ‡∏¢‡∏Å‡∏Ç‡∏¢‡∏∞")
st.caption("‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏ö‡∏ö‡∏à‡∏≤‡∏Å‡∏Ñ‡πà‡∏≤‡∏¢ CalcTech Camp x CASIO | ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Python + Streamlit")

# ----------------------------
# ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
# ----------------------------
col1, col2 = st.columns(2)
with col1:
    waste_type = st.selectbox("‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏¢‡∏∞‡∏´‡∏•‡∏±‡∏Å", ["‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å", "‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©", "‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡∏µ‡∏¢‡πå", "‡∏≠‡∏∑‡πà‡∏ô ‡πÜ"])
    waste_amount = st.number_input("‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏Ç‡∏¢‡∏∞‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô (‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°)", min_value=1.0)
    machine_count = st.number_input("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£", min_value=1, step=1)
    power_per_machine = st.number_input("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏ü‡∏ï‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (‡∏ß‡∏±‡∏ï‡∏ï‡πå)", min_value=100.0)

with col2:
    work_hours = st.number_input("‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô", min_value=1.0, max_value=24.0)
    sunlight_hours = st.number_input("‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡πÅ‡∏î‡∏î‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô", min_value=1.0, max_value=12.0)
    panel_power = st.number_input("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏ú‡∏á‡∏ï‡πà‡∏≠‡πÅ‡∏ú‡∏á (‡∏ß‡∏±‡∏ï‡∏ï‡πå)", min_value=100.0)

# ----------------------------
# ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
# ----------------------------
if st.button("‚òÄÔ∏è ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô"):
    # ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
    energy_used = (machine_count * power_per_machine * work_hours) / 1000  # kWh ‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô
    energy_per_panel = (panel_power * sunlight_hours * 0.75) / 1000        # kWh ‡∏ï‡πà‡∏≠‡πÅ‡∏ú‡∏á‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô (‡πÉ‡∏ä‡πâ 0.75 ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£)
    panels_needed = energy_used / energy_per_panel if energy_per_panel > 0 else 0
    co2_saved = energy_used * 0.43 * 30  # kgCO‚ÇÇ/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏™‡∏°‡∏°‡∏∏‡∏ï‡∏¥‡∏ê‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢)

    # ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
    st.subheader("üîç ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì")
    st.metric("‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô", f"{energy_used:.2f} kWh")
    st.metric("‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï‡πÑ‡∏î‡πâ‡∏ï‡πà‡∏≠‡πÅ‡∏ú‡∏á‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô", f"{energy_per_panel:.2f} kWh")
    st.metric("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ú‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ", f"{panels_needed:.1f} ‡πÅ‡∏ú‡∏á")
    st.metric("‡∏Ñ‡∏≤‡∏£‡πå‡∏ö‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏î‡πÑ‡∏î‡πâ‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô", f"{co2_saved:.1f} kgCO‚ÇÇ")

    # ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü
    fig, ax = plt.subplots()
    ax.bar(["‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á", "‡∏ú‡∏•‡∏¥‡∏ï‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°"], [energy_used, energy_per_panel * panels_needed], color=["#ffb703", "#219ebc"])
    ax.set_ylabel("‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô (kWh)")
    ax.set_title("‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á vs ‡∏ú‡∏•‡∏¥‡∏ï‡πÑ‡∏î‡πâ")
    st.pyplot(fig)

    # ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏õ‡πá‡∏ô CSV
    df = pd.DataFrame({
        "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£": ["‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á", "‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏¥‡∏ï‡πÑ‡∏î‡πâ", "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ú‡∏á", "‡∏•‡∏î‡∏Ñ‡∏≤‡∏£‡πå‡∏ö‡∏≠‡∏ô‡πÑ‡∏î‡πâ (‡∏Å‡∏Å./‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)"],
        "‡∏Ñ‡πà‡∏≤": [energy_used, energy_per_panel * panels_needed, panels_needed, co2_saved]
    })
    st.download_button(
        label="üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå (CSV)",
        data=df.to_csv(index=False).encode('utf-8'),
        file_name="sun_to_sort_result.csv",
        mime="text/csv",
    )

st.info("üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡πÅ‡∏î‡∏î‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏ú‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡∏≠‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå")
